$(".wcms-cell").removeClass("wcms-cell-active");

var pos = $("#wcms-work-cell-<%= @row.id %>-<%= @cell.id %>").position();
var cellWidth = $("#wcms-work-cell-<%= @row.id %>-<%= @cell.id %>").width();
var rowWidth = $("#wcms-row-<%= @row.id %>").width();
var toolbarWidth = $("#wcms-cell-toolbar").width();
var newLeft = pos.left

if (toolbarWidth == 0 || toolbarWidth == null) {
	toolbarWidth = 265
}

if ((rowWidth - pos.left) < toolbarWidth) {
	newLeft = rowWidth - toolbarWidth;
} else {
	newLeft = pos.left;
	newLeft = ((cellWidth-toolbarWidth)/2) + newLeft
	if (newLeft < 0) {newLeft = 0}
}

$("#wcms-work-cell-<%= @row.id %>-<%= @cell.id %>").addClass("wcms-cell-active");
$("#wcms-toolbar-div-<%= @row.id %>").html("<%= j render(:partial => 'cells/toolbar_top', :locals => {:cell => @cell}) -%>");
if($("#wcms-toolbar-div-<%= @row.id %>").is(':visible')){
	$("#wcms-toolbar-div-<%= @row.id %>").animate({'left' : newLeft + "px"}, "slow");
} else {
	$(".wcms-toolbar-div").fadeOut();
	$("#wcms-toolbar-div-<%= @row.id %>").fadeIn();
	$("#wcms-toolbar-div-<%= @row.id %>").css("left", newLeft);
}